<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Using JST as a source of Angular templates | Julio</title>
    <meta content='Blog' name='description'>
    <meta content='width=device-width' name='viewport'>
    <link href='https://plus.google.com/117723231368654711284/posts' rel='author'>
    <meta content='summary' name='twitter:card'>
    <meta content='@julioolvr' name='twitter:site'>
    <meta content='Using JST as a source of Angular templates' name='twitter:title'>
    <meta content="If you're using Rails, a nice tool to expose your Javascript templates is JST. JST allows you to write HTML templates for your JS library of choice, and it exposes them in a JST global object on the client side, using their path relative to the Javascript asset's path as the key. They play nicely with Angular.js and there's a way to make Angular “JST aware” so to speak.&#x000A;" name='twitter:description'>
    <script src="../../../../javascripts/vendor/modernizr-2.6.1.min.js" type="text/javascript"></script>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans|Bree+Serif" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Roboto:400,100,300" rel="stylesheet" type="text/css" />
    <link href="../../../../stylesheets/site.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <!--[if lt IE 7]> <p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p> <![endif]-->
    <div class='content'>
      <div class='main' role='main'>
        <article class='post'>
          <div class='date'>
            2015/10/15
          </div>
          <h1>
            Using JST as a source of Angular templates
          </h1>
          <div class='tags'>
            <a href="/tags/javascript/">#javascript</a>, <a href="/tags/rails/">#rails</a>, <a href="/tags/angularjs/">#angularjs</a>
          </div>
          <p>If you&#39;re using Rails, a nice tool to expose your Javascript templates is <a href="https://github.com/sstephenson/sprockets#javascript-templating-with-ejs-and-eco">JST</a>. JST allows you to write HTML templates for your JS library of choice, and it exposes them in a <code>JST</code> global object on the client side, using their path relative to the Javascript asset&#39;s path as the key. They play nicely with Angular.js and there&#39;s a way to make Angular &ldquo;JST aware&rdquo; so to speak.</p>
          
          <p></p>
          
          <p>Usually, if you&#39;re writing some piece of Angular code that uses a template like a directive or a route, you would be able to use your JST templates writing something like:</p>
          <pre class="highlight javascript"><code><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">)</span>&#x000A;  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'someDirective'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="p">{</span>&#x000A;      <span class="na">template</span><span class="p">:</span> <span class="nx">JST</span><span class="p">[</span><span class="s1">'some/template/path'</span><span class="p">]()</span>&#x000A;    <span class="p">};</span>&#x000A;  <span class="p">});</span>&#x000A;</code></pre>
          
          <p>This would execute the template function generated by JST, generate the HTML and set it as the directive&#39;s template. This is all fine, but let&#39;s look at some other ways of doing it.</p>
          
          <p>When we try to find a template with an URL, Angular&#39;s first step is to look for it on its <code>$templateCache</code>. If it can&#39;t find it, it will try to fetch it from the server. Knowing that, we can manually inject our templates in the <code>$templateCache</code>:</p>
          <pre class="highlight javascript"><code><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">)</span>&#x000A;  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'someDirective'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="p">{</span>&#x000A;      <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'some/template/path'</span>&#x000A;    <span class="p">};</span>&#x000A;  <span class="p">})</span>&#x000A;  <span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">'$templateCache'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$templateCache</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="nx">$templateCache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">'some/template/path'</span><span class="p">,</span> <span class="nx">JST</span><span class="p">[</span><span class="s1">'some/template/path'</span><span class="p">]);</span>&#x000A;  <span class="p">}]);</span>&#x000A;</code></pre>
          
          <p>In this case, we&#39;re providing the <code>$templateCache</code> directly with a function that will generate the template. Angular will find and use it when looking for that <code>templateUrl</code>. Now, this is all very repetitive, and we can avoid it by <a href="https://docs.angularjs.org/api/auto/service/$provide#decorator">decorating</a> the <code>$templateCache</code> that is used all over Angular to make it try and fetch from JST first.</p>
          <pre class="highlight javascript"><code><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">)</span>&#x000A;  <span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$provide'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="nx">$provide</span><span class="p">.</span><span class="nx">decorator</span><span class="p">(</span><span class="s1">'$templateCache'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$delegate</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">get</span> <span class="o">=</span> <span class="nx">$delegate</span><span class="p">.</span><span class="nx">get</span><span class="p">;</span>&#x000A;&#x000A;        <span class="nx">$delegate</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>&#x000A;            <span class="k">return</span> <span class="nx">JST</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>&#x000A;        <span class="p">}</span>&#x000A;&#x000A;        <span class="k">return</span> <span class="nx">$delegate</span><span class="p">;</span>&#x000A;    <span class="p">});</span>&#x000A;  <span class="p">}]);</span>&#x000A;</code></pre>
          
          <p>And that&#39;s it! From then on, you can use a JST key anywhere you&#39;d use a template URL and Angular will automatically take it from JST.</p>
          <div class='comments'>
            <div id='disqus_thread'></div>
            <script>
              var disqus_shortname = 'julioblog'; // required: replace example with your forum shortname
              
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
            <a class='dsq-brlink' href='http://disqus.com'>
              comments powered by
              <span class='logo-disqus'>Disqus</span>
            </a>
          </div>
        </article>
      </div>
      <section class='sidebar'>
        <a href='/'>
          <img class="sidebar-profile-pic" src="http://www.gravatar.com/avatar/a81ad64d19c864be3c478b761f4b4817?s=300" />
        </a>
        <ul class='sidebar-bio'>
          <li>
            <a href='/'>julio olivera</a>
          </li>
          <li>software developer</li>
          <li>
            <a href='http://github.com/julioolvr' target='blank'>github</a>,
            <a href='http://www.twitter.com/julioolvr' target='blank'>twitter</a>
          </li>
        </ul>
      </section>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
    <script>
      window.jQuery || document.write('<script src="javascripts/vendor/jquery-1.8.0.min.js"><\/script>')
    </script>
    <script src="../../../../javascripts/site.js" type="text/javascript"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38383863-1']);
      _gaq.push(['_setDomainName', 'joliv.me']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
