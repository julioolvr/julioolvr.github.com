<!DOCTYPE html><head><title>Using JST as a source of Angular templates | Julio</title><meta charset="utf-8"><link rel="shortcut icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/highlight-ocean.css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans|Bree+Serif"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Raleway:400,100,300"><script async src="//codepen.io/assets/embed/ei.js"></script></head><body><div class="container"><header><a href="/"><img class="profile-pic" src="http://www.gravatar.com/avatar/a81ad64d19c864be3c478b761f4b4817?s=300"></a><ul class="bio"><li><a href="/">julio olivera</a></li><li>software developer</li><li><a href="http://github.com/julioolvr">github</a>,
<a href="http://www.twitter.com/julioolvr">twitter</a></li></ul></header><main><article class="post"><time datetime="2015-10-15T00:00:00.000Z">2015/10/14</time><h1>Using JST as a source of Angular templates</h1><div class="tags"><a href="/tags/javascript">#javascript</a>,
<a href="/tags/rails">#rails</a>,
<a href="/tags/angularjs">#angularjs</a></div><p>If you're using Rails, a nice tool to expose your Javascript templates is <a href="https://github.com/sstephenson/sprockets#javascript-templating-with-ejs-and-eco">JST</a>. JST allows you to write HTML templates for your JS library of choice, and it exposes them in a <code>JST</code> global object on the client side, using their path relative to the Javascript asset's path as the key. They play nicely with Angular.js and there's a way to make Angular &quot;JST aware&quot; so to speak.</p>
<p>Usually, if you're writing some piece of Angular code that uses a template like a directive or a route, you would be able to use your JST templates writing something like:</p>
<pre class="hljs"><code>angular.module(<span class="hljs-string">'app'</span>)
  .directive(<span class="hljs-string">'someDirective'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">template</span>: JST[<span class="hljs-string">'some/template/path'</span>]()
    };
  });
</code></pre>
<p>This would execute the template function generated by JST, generate the HTML and set it as the directive's template. This is all fine, but let's look at some other ways of doing it.</p>
<p>When we try to find a template with an URL, Angular's first step is to look for it on its <code>$templateCache</code>. If it can't find it, it will try to fetch it from the server. Knowing that, we can manually inject our templates in the <code>$templateCache</code>:</p>
<pre class="hljs"><code>angular.module(<span class="hljs-string">'app'</span>)
  .directive(<span class="hljs-string">'someDirective'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'some/template/path'</span>
    };
  })
  .run([<span class="hljs-string">'$templateCache'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$templateCache</span>) </span>{
    $templateCache.put(<span class="hljs-string">'some/template/path'</span>, JST[<span class="hljs-string">'some/template/path'</span>]);
  }]);
</code></pre>
<p>In this case, we're providing the <code>$templateCache</code> directly with a function that will generate the template. Angular will find and use it when looking for that <code>templateUrl</code>. Now, this is all very repetitive, and we can avoid it by <a href="https://docs.angularjs.org/api/auto/service/$provide#decorator">decorating</a> the <code>$templateCache</code> that is used all over Angular to make it try and fetch from JST first.</p>
<pre class="hljs"><code>angular.module(<span class="hljs-string">'app'</span>)
  .config([<span class="hljs-string">'$provide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$provide</span>) </span>{
    $provide.decorator(<span class="hljs-string">'$templateCache'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$delegate</span>) </span>{
        <span class="hljs-keyword">var</span> get = $delegate.get;

        $delegate.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
            <span class="hljs-keyword">return</span> JST[key] || get(key);
        }

        <span class="hljs-keyword">return</span> $delegate;
    });
  }]);
</code></pre>
<p>And that's it! From then on, you can use a JST key anywhere you'd use a template URL and Angular will automatically take it from JST.</p>
<div class="comments"><div id="disqus_thread"></div><script>var disqus_shortname = 'julioblog'; // required: replace example with your forum shortname

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><a class="dsq-brlink" href="http://disqus.com"><comments>powered by</comments><span class="logo-disqus">Disqus</span></a></div></article></main></div></body>